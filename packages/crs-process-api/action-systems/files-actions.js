class g{static async perform(e,a,t,n){await this[e.action](e,a,t,n)}static async load(e,a,t,n){if(await crs.process.getValue(e.args.dialog,a,t,n)==!0){const r=await m(e);let i=[];for(const s of r){const c=await d(s.name);i.push({name:c.name,ext:c.ext,type:s.type,size:s.size,value:s})}return e.args.target!=null&&await crs.process.setValue(e.args.target,i,a,t,n),i}else{const r=await p(e,a,t,n);return e.args.target!=null&&await crs.process.setValue(e.args.target,r,a,t,n),r}}static async save(e,a,t,n){const l=await crs.process.getValue(e.args.details,a,t,n);let r=document.createElement("a");r.style.display="none",document.body.appendChild(r);for(let i of l){let s=new Blob([i.value],{type:i.type}),c=window.URL.createObjectURL(s);r.href=c,r.download=`${i.name}.${i.ext}`,r.click(),window.URL.revokeObjectURL(c),c=null,s=null}r.parentElement.removeChild(r),r=null}static async save_canvas(e,a,t,n){const l=await crs.dom.get_element(e.args.source),r=await crs.process.getValue(e.args.name,a,t,n)||"image",i=l.toDataURL("image/png");let s=document.createElement("a");s.style.display="none",document.body.appendChild(s),s.href=i.replace("image/png","image/octet-stream"),s.download=`${r}.png`,s.click(),s.parentElement.removeChild(s),s=null}static async enable_dropzone(e,a,t,n){const l=await crs.dom.get_element(e.args.element,a,t,n),r=await crs.process.getValue(e.args.handler,a,t,n);l.addEventListener("drop",f.bind(this,r)),l.addEventListener("dragover",u),l.__dropHandler=f,l.__dragoverHandler=u}static async disable_dropzone(e,a,t,n){const l=await crs.dom.get_element(e.args.element,a,t,n);l.removeEventListener("drop",l.__dropHandler),l.removeEventListener("dragover",l.__dragoverHandler),delete l.__dropHandler,delete l.__dragoverHandler}}class w{static async blob(e){return new Promise(a=>{const t=new FileReader;t.onload=()=>{t.onload=null,a(t.result)},t.readAsArrayBuffer(e)})}}async function d(o){const e=o.split("/"),t=e[e.length-1].split("."),n=t[t.length-1];return{name:t[0],ext:n}}async function m(){return new Promise(o=>{let e=document.createElement("input");e.type="file",e.setAttribute("multiple","multiple"),e.onchange=()=>{e.onchange=null;const a=Array.from(e.files);o(a)},e.click()})}async function p(o,e,a,t){const n=await crs.process.getValue(o.args.files,e,a,t),l=[];for(const r of n){const i=await d(r);l.push({name:i.name,ext:i.ext,value:await fetch(r).then(s=>s.blob())})}return l}async function u(o){o.preventDefault()}async function f(o,e){e.preventDefault();const a=e.dataTransfer.files,t=[];for(const n of a){const l=await d(n.name);t.push({type:n.type,name:l.name,ext:l.ext,size:n.size,value:n})}o.call(this,t)}crs.intent.file=g;export{g as FileActions,w as FileFormatter,d as get_file_name,p as get_files};
