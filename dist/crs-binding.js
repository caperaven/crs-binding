var x=Object.getPrototypeOf(async function(){}).constructor;function ge(i,e,t){e=e||[];let n=!0,s=!1,r="context";if(t!=null&&(t.sanitize!=null&&(n=t.sanitize),t.async!=null&&(s=t.async),t.ctxName!=null&&(r=t.ctxName)),crsbinding._expFn.has(i)){let h=crsbinding._expFn.get(i);return h.count+=1,h}let a=i,l;if(n==!0){if(l=crsbinding.expression.sanitize(i,r),crsbinding._expFn.has(l.expression)){let p=crsbinding._expFn.get(l.expression);return p.count+=1,p}a=l.isLiteral===!0?["return `",l.expression,"`"].join(""):`return ${l.expression}`,l.expression.split(".").length>2&&(a=`try { ${a} } catch(error) { return null }`)}else l={expression:i};let c={function:s==!0?new x(r,...e,a):new Function(r,...e,a),parameters:l,count:1};return crsbinding._expFn.set(l.expression,c),c}function xe(i){if(i==null||typeof i!="object")return;let e=i.parameters.expression;if(crsbinding._expFn.has(e)){let t=crsbinding._expFn.get(e);t.count-=1,t.count==0&&(crsbinding.utils.disposeProperties(t),crsbinding._expFn.delete(e))}}var d=Object.freeze({WORD:"word",LITERAL:"literal",FUNCTION:"function",PROPERTY:"property",OBJECT:"object",KEYWORD:"keyword",OPERATOR:"operator",NUMBER:"number",SPACE:"space",STRING:"string"});function ye(i,e){let t=[],n=[],s=0;function r(l,o){if(n.length>0){let c=n.join("");a(c)}t.push({type:l,value:o})}function a(l){let o=d.WORD;be.indexOf(l)!=-1&&(o=d.KEYWORD),isNaN(Number(l))==!1&&(o=d.NUMBER),t.push({type:o,value:l}),n.length=0}for(s;s<i.length;s++){let l=i[s];if(l==" "){r(d.SPACE," ");continue}if(l=="`"){r(d.LITERAL,"`");continue}if(l=="$"&&i[s+1]=="{"){r(d.KEYWORD,"${"),s++;continue}if(l=="'"||l=='"'){let o=s+i.length-s,c=!1;if(i[s+1]==null){r(d.STRING,l);break}let h=s+1;for(h;h<o;h++){if(i[h]=="$"&&i[h+1]=="{"){c=!0;break}if(i[h]==l){let p=i.substring(s,h+1);r(d.STRING,p);break}}c==!0?r(d.STRING,l):s=h;continue}if(be.indexOf(l)!=-1){r(d.KEYWORD,l);continue}if(ve.indexOf(l)!=-1){for(let o=s;o<s+4;o++){let c=i[o];if(ve.indexOf(c)==-1){let h=i.substring(s,o);r(d.OPERATOR,h),s=o-1;break}}continue}n.push(l)}return n.length>0&&a(n.join("")),rt(t,e)}function rt(i,e){if(i.length==1&&i[0].type==d.WORD)return i[0].type=d.PROPERTY,i;let t=[],n=!1,s=0;for(;i[s]!=null;){let r=i[s],a=t.length==0?"none":t[t.length-1],l=r.value.indexOf(".");if(r.type==d.WORD)if(a==d.LITERAL){if(r.value[0]=="."&&i[s+1].value=="("){r.type=d.FUNCTION,s++;continue}r.type=d.PROPERTY}else l!=-1?i[s-1]?.value===")"&&l===0?r.type=d.FUNCTION:r.type=d.PROPERTY:j(i[s+1])||j(i[s+2])?e!==!0&&a!==d.OBJECT&&(r.type=d.PROPERTY):e!==!0&&j(i[s-1])||j(i[s-2])?a!==d.OBJECT&&(r.type=d.PROPERTY):s===0&&i[s+1]?.value==="("&&(r.type=d.PROPERTY);if(r.type==d.KEYWORD&&r.value=="("&&i[s-1]&&i[s-1].type==d.PROPERTY&&i[s-1].value[0]!="$"){let o=i[s-1].value;if(o.indexOf(".")==-1)i[s-1].type=d.FUNCTION;else{let c=o.length-1;for(let h=o.length-1;h>=0;h--)if(o[h]=="."){c=h;break}if(c>0){let h=o.substring(0,c),p=o.substring(c,o.length);i[s-1].value=h,i.splice(s,0,{type:d.FUNCTION,value:p}),s++}else i[s-1].type=d.FUNCTION}}r.value=="${"?t.push(d.LITERAL):r.value=="{"?t.push(d.OBJECT):r.value=="}"&&t.pop(),s++}return i[0].type===d.FUNCTION&&(i[0].type=d.PROPERTY),i}function j(i){return i==null?!1:i.type==d.OPERATOR}var ve=["=","!","<",">","+","-","*","/","&","|","?",":"],be=["{","}","(",")",",","true","false","null","undefined","[]"];var at=["false","true","null"];function Ce(i,e="context",t=!1){let n=!1;if(typeof i=="string"&&i.indexOf("$html")!=-1&&(n=!0,i=i.split("$html.").join("")),i==null||i=="null"||i=="undefined"||at.indexOf(i.toString())!=-1||isNaN(i)==!1||i.trim()==e)return{isLiteral:!0,expression:i,isHTML:n};if(e!="context"==!0&&i==["${",e,"}"].join(""))return{isLiteral:!0,expression:i};let r=new Set,a=i.indexOf("${")!=-1,l=ye(i,a),o=[];for(let c of l)c.type=="property"?(c.value.indexOf("$globals")!=-1?o.push(c.value.replace("$globals","crsbinding.data.globals")):c.value.indexOf("$event")!=-1?o.push(c.value.replace("$event","event")):c.value.indexOf("$context")!=-1?o.push(c.value.replace("$context","context")):c.value.indexOf("$data")!=-1?o.push(c.value.replace("$data","crsbinding.data.getValue")):c.value.indexOf("$parent")!=-1?o.push(c.value.replace("$parent","parent")):e!=="context"&&c.value.indexOf(`${e}.`)!=-1?o.push(c.value):o.push(`${e}.${c.value}`),ct(r,c.value,e)):o.push(c.value);return{isLiteral:a,isHTML:n,expression:o.join(""),properties:Array.from(r)}}var lt=[".trim",".toLowerCase","toUpperCase"],ot=["$data","$event"];function ct(i,e,t){if(e.length==0)return;for(let r of ot)if(e.indexOf(r)!=-1)return;let n=e,s=`${t}.`;n.indexOf(s)==0&&(n=n.replace(s,""));for(let r of lt)n.indexOf(r)!=-1&&(n=n.split(r).join(""));i.add(n)}var u=class{get data(){return crsbinding.data.getValue(this._context)}constructor(e,t,n,s,r,a,l=!0){this._cleanEvents=[],this._element=e,this._context=t,this._property=n,this._value=s,this._ctxName=r||"context",this._eventsToRemove=[],this._isNamedContext=this._ctxName!="context",this._parentId=a,this._value&&this._value.indexOf("$parent")!=-1&&l==!0&&(this._value=this._value.split("$parent.").join(""),this._context=a),this._value&&this._value.indexOf("$self")!=-1&&(this._value=this._value.split("$self.").join(""),this._context=this._element._dataId),this.init&&this.init(),crsbinding.providerManager.register(this),this.initialize().catch(o=>{throw o}),this._element.nodeName.indexOf("-")!=-1&&this._property==this._ctxName&&(this._element[this._property]=this._context)}dispose(){this._eventsToRemove.length=0,this._eventsToRemove=null,this._element=null,this._context=null,this._property=null,this._value=null,this._ctxName=null,crsbinding.events.removeOnPath(this._cleanEvents),this._cleanEvents=null}async initialize(){}listenOnPath(e,t){let n=Array.isArray(e)==!0?e:[e];for(let s of n){let r=crsbinding.events.listenOnPath(this._context,s,t);this._cleanEvents=[...this._cleanEvents,...r]}}};var Oe="requestAnimationFrame(() => element.__property__ = value);",Ee='requestAnimationFrame(() => element.__property__ = value == null ? "" : value);';var Pe="requestAnimationFrame(() => element.__property__ = (__exp__) ? __true__ : __false__)",we='element.dataset["__property__"] = value == null ? "" : value',$e=`
if (element.__classList!=null) {
    const remove = Array.isArray(element.__classList) ? element.__classList : [element.__classList];
    remove.forEach(cls => element.classList.remove(cls));
}`,oe=`
element.__classList = value;
const add = Array.isArray(value) ? value : [value];
add.forEach(cls => element.classList.add(cls));`,Ae=`${$e} ${oe}`,je=`
    ${$e}

    if (__exp__) {
        ${oe.split("value").join("__true__")}
    }
    else {
        ${oe.split("value").join("__false__")}
    }
`;function Te(i){let e=[];for(let t of i.children)e.push(t.outerHTML);return e.join("")}function Ie(i){return i.content!=null?i.content.cloneNode(!0):i.children[0].cloneNode(!0)}function Se(i){return new Promise(e=>{let t=i,n;i.nodeName==="#document-fragment"?(t=document.createElement("div"),t.appendChild(i),t.style.width="max-content",t.style.height="max-content",t.style.position="fixed",t.style.transform="translate(-100px, -100px)",document.body.appendChild(t),n=t.getBoundingClientRect(),document.body.removeChild(t)):n=t.getBoundingClientRect(),e(n)})}var ht=["_element"];function ce(i){if(i==null||Object.isFrozen(i))return;let e=Object.getOwnPropertyNames(i).filter(t=>ht.indexOf(t)==-1);for(let t of e){let n=i[t];if(typeof n=="object"){if(n==null||n.autoDispose==!1)continue;Array.isArray(n)!=!0&&ce(n)}delete i[t]}}function T(i,e,t){i[e]=t,i.__cleanup=i.__cleanup||[],i.__cleanup.push(e)}function he(i){if(i==null||i[i.length-1]=="/")return i;let e=i.split("/");return e.pop(),`${e.join("/")}/`}function ke(i,e){let t=he(i),n=["","."],s=e.split("./"),r=t.split("/");r.pop();let a=0;for(let c=0;c<s.length;c++){let h=s[c];if(n.indexOf(h)===-1)break;h=="."&&r.pop(),a+=1}s.splice(0,a);let l=s.join("/");return`${r.join("/")}/${l}`}function b(i){let e=i.split("of"),t=e[0].trim(),n=e[1].trim();return{singular:t,plural:n}}function P(i,e,t){if(typeof e=="string")i[0]==="."&&(i=i.substring(1)),t[i]=e;else{let n=Object.keys(e);for(let s of n)P(`${i}.${s}`,e[s],t)}}function I(i){let e;if(i._property.toLocaleLowerCase()=="classlist")return Ae;if(i._property.indexOf("data-")!=-1){let t=i._property.replace("data-","");return we.split("__property__").join(t)}return e=i._property=="value"||i._property=="placeholder"?Ee:Oe,i._property=crsbinding.utils.capitalizePropertyPath(i._property),e.split("__property__").join(i._property)}function Ne(i,e,t){if(i!=null&&e!=null){let n=()=>{i.removeEventListener("ready",n);let s=crsbinding.data.getValue(t);T(i,e,s)};i.isReady==!0?n():i.addEventListener("ready",n)}}function m(i){let e={path:i.trim()};return dt(e),ut(e),pt(e),e}function dt(i){i.path[0]=="$"&&i.path[1]=="{"&&(i.path=i.path.substring(2,i.path.length-1))}function ut(i){let e=_t(i.path,":");i.path=e[0],i.converter=e[1]}function pt(i){let e=i.converter.indexOf("("),t=i.converter.indexOf(")"),n=i.converter.substring(e+1,t).split("'").join('"'),s=i.converter.substring(0,e),r=i.converter.substring(t+1,i.converter.length);i.converter=s,i.parameter=n.length==0?null:JSON.parse(n),i.postExp=r}function _t(i,e){let t=i.indexOf(e),n=[];return n.push(i.substring(0,t)),n.push(i.substring(t+1,i.length)),n}var y=class extends u{dispose(){let e=`${this._ctxName}.`;this._value.indexOf(e)==0&&(this._value=this._value.replace(e,"")),this._expObj!=null&&(crsbinding.expression.release(this._expObj),delete this._expObj),this._exp=null,this._eventHandler=null,this._converter=null,this._getConvertFn=null,super.dispose()}async initialize(){if(this._value=="$context"||this._value==this._ctxName)return Ne(this._element,this._property,this._context);if(this._value.indexOf(":")!=-1){this._converter=m(this._value);let n=`return crsbinding.valueConvertersManager.convert(value, "${this._converter.converter}", "get", params)${this._converter.postExp}`;this._getConvertFn=new Function("value","params",n)}this._eventHandler=this.propertyChanged.bind(this),this._exp=I(this),this._expObj=crsbinding.expression.compile(this._exp,["element","value"],{sanitize:!1,ctxName:this._ctxName});let e=this._converter==null?this._value:this._converter.path;this._isNamedContext==!0&&(e=this._value.split(`${this._ctxName}.`).join("")),this.listenOnPath(e,this._eventHandler);let t=crsbinding.data.getValue(this._context,e);this._getConvertFn!=null&&(t=this._getConvertFn(t,this._converter.parameter)),t!=null&&this.propertyChanged(e,t)}propertyChanged(e,t){this._expObj!=null&&(this._isLinked!=!0&&this._element._dataId!=null&&(crsbinding.data.link(this._context,e,this._element._dataId,this._property,t),this._isLinked=!0),this._getConvertFn!=null&&(t=this._getConvertFn(t,this._converter.parameter)),crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element,t)))}};var ft=["INPUT","SELECT","TEXTAREA"],w=class extends y{dispose(){this._element.removeEventListener(this._eventName,this._changeHandler),this._eventName=null,this._changeHandler=null,super.dispose()}async initialize(){await super.initialize(),this._changeHandler=this._change.bind(this),this._eventName=ft.indexOf(this._element.nodeName)!==-1?"change":`${this._property}Change`,this._element.addEventListener(this._eventName,this._changeHandler),this._value.indexOf("$globals.")!==-1&&(this._context=crsbinding.$globals,this._value=this._value.split("$globals.").join(""))}_change(e){let t=e.target[this._property],n=e.target.type||"text",s=`_${n}`;this[s]!=null&&(t=this[s](t,e.target)),this._converter!=null&&(t=crsbinding.valueConvertersManager.get(this._converter.converter).set(t,this._converter.parameter));let r=this._converter==null?this._value:this._converter.path,a=crsbinding.data.getValue(this._context,this._value);crsbinding.data._setContextProperty(this._context,r,t,{oldValue:a,ctxName:this._ctxName,dataType:n=="text"?"string":n}),e.stopPropagation()}_number(e){return Number(e)}_date(e){return new Date(e)}_checkbox(e,t){return t.checked==!0}};var S=class extends u{dispose(){this._expObj!=null&&(crsbinding.expression.release(this._expObj),delete this._expObj),this._exp=null,this._getValueFn=null,this._eventHandler=null,super.dispose()}async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._exp=I(this),this._expObj=crsbinding.expression.compile(this._exp,["element","value"],{sanitize:!1,ctxName:this._ctxName});let e=crsbinding.expression.sanitize(this._value,this._ctxName);this._getValueFn=new Function(this._ctxName,`return ${e.expression}`);for(let t of e.properties)this.listenOnPath(t,this._eventHandler);this.propertyChanged()}propertyChanged(){let e=this._getValueFn(this.data);crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element,e))}};function Le(i,e,t,n,s="context",r){return s=="context"?mt(i,e,t,n,r):gt(i,e,t,n,s,r),null}function mt(i,e,t,n){He(i,t,crsbinding.data.getValue(e,n))}function gt(i,e,t,n,s){s!="context"&&(n=n.split(`${s}.`).join(""));let r=crsbinding.data.getValue(e,n);He(i,t,r)}function He(i,e,t){if(e.indexOf("data-")==-1)e=crsbinding.utils.capitalizePropertyPath(e),T(i,e,t);else{let n=e.replace("data-","");i.dataset[n]=t}}var f=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this._eventHandler=this.event.bind(this),this._element.addEventListener(this._property,this._eventHandler)}dispose(){this._element.removeEventListener(this._property,this._eventHandler),this._eventHandler=null,this._fn=null,super.dispose()}async initialize(){let e=`context.${this._value}`.split("$event").join("event");e.indexOf(")")==-1&&(e=`${e}.call(context, event)`),this._fn=new Function("context","event",e)}event(e){let t=crsbinding.data.getContext(this._context);crsbinding.idleTaskManager.add(this._fn(t,e))}};var k=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a);let l=e.textContent;l.indexOf("$parent.")!=-1&&(e.textContent=l.split("$parent.").join(""),this._context=a),this._value=l,this._eventHandler=this._change.bind(this),this._expObj=crsbinding.expression.compile(this._value,null,{ctxName:this._ctxName});for(let o of this._expObj.parameters.properties)this.listenOnPath(o,this._eventHandler);this._change()}dispose(){crsbinding.expression.release(this._expObj),this._expObj=null,super.dispose(),this._eventHandler=null}_change(){if(this._expObj==null)return;let e=this._expObj.function(this.data);e=e==null?"":e.split("undefined").join("");let t="textContent";this._expObj.parameters.isHTML==!0&&(t="innerHTML"),this._element[t]=e}};var C=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this._eventHandler=this._change.bind(this),this._expObj=crsbinding.expression.compile(this._value,null,{ctxName:this._ctxName});for(let l of this._expObj.parameters.properties)this.listenOnPath(l,this._eventHandler);this._change()}dispose(){crsbinding.expression.release(this._expObj),this._expObj=null,super.dispose(),this._eventHandler=null}_change(){let e=this._expObj.function(this.data);e==null?this._element.removeAttribute(this._property):this._element.setAttribute(this._property,e)}};var g=class extends u{dispose(){this._singular=null,this._plural=null,this._container=null,this._collectionChangedHandler=null,this.positionStruct.addAction=null,this.positionStruct.removeAction=null,this.positionStruct=null,super.dispose()}async initialize(){this._container=this._element.parentElement,this._shouldClearAll=this._container.children.length==1,this._determineInsertParameters();let e=this._value.split("of");this._singular=e[0].trim(),this._plural=e[1].trim(),this._collectionChangedHandler=this._collectionChanged.bind(this),this.listenOnPath(this._plural,this._collectionChangedHandler)}async _collectionChanged(e,t){if(t==null)return this._clear();await this._renderItems(t)}_determineInsertParameters(){let e=this._element.nextElementSibling,t=this._element.previousElementSibling;this.positionStruct={startIndex:Array.from(this._container.children).indexOf(this._element),addAction:e!=null?this._insertBefore.bind(e):this._appendItems.bind(this._element),removeAction:()=>this._removeBetween.call(this._element,t,e)}}_appendItems(e){this.parentElement.appendChild(e)}_insertBefore(e){this.parentElement.insertBefore(e,this)}_removeBetween(e,t){let n=Array.from(this.parentElement.children),s=n.indexOf(e),r=n.indexOf(t);s==-1&&(s=0),r==-1&&(r=n.length);let a=[];for(let l=s+1;l<r;l++)n[l].nodeName.toLowerCase()!="template"&&a.push(n[l]);for(let l of a)l.parentElement.removeChild(l)}_clear(){this._shouldClearAll==!0?this._clearAll():this._clearPartial()}_clearAll(){let e=Array.from(this._container.children).filter(t=>t.nodeName.toLowerCase()!="template");for(let t of e)t.parentElement.removeChild(t),crsbinding.observation.releaseBinding(t)}_clearPartial(){this.positionStruct.removeAction()}async _renderItems(){this._clear()}async createElement(e,t){let n=this._element.dataset.reference||"array-item",s=crsbinding.data.createReferenceTo(this._context,`${this._context}-${n}-${t}`,this._plural,t),r=crsbinding.utils.cloneTemplate(this._element);await crsbinding.parsers.parseElement(r,s,{ctxName:this._singular,parentId:this._context}),e.__uid=s;for(let a of r.children)a.dataset.uid=s;return r}updateAttributeProviders(e){for(let t of e.__providers||[]){let n=crsbinding.providerManager.items.get(t);n instanceof C&&n._change()}}};var N=class extends g{init(){this._itemsAddedHandler=this._itemsAdded.bind(this),this._itemsDeletedHandler=this._itemsDeleted.bind(this)}dispose(){this._itemsAddedHandler=null,this._itemsDeletedHandler=null,super.dispose()}async initialize(){super.initialize(),crsbinding.data.setArrayEvents(this._context,this._plural,this._itemsAddedHandler,this._itemsDeletedHandler)}async _renderItems(e){await super._renderItems();let t=document.createDocumentFragment();for(let n of e){n.__aId=crsbinding.data.nextArrayId();let s=await this.createElement(n,n.__aId);t.appendChild(s)}this.positionStruct.addAction(t),this._container.__providers==null&&(this._container.__providers=[]),this._container.__providers.indexOf(this.id)==-1&&this._container.__providers.push(this.id),this._container.dispatchEvent(new CustomEvent("rendered"))}_itemsAdded(e,t){for(let n=0;n<e.length;n++){let s=e[n],r=t.indexOf(s);s.__aId=crsbinding.data.nextArrayId(),this.createElement(s,s.__aId).then(a=>{let l=a.children[0],o=this._container.children[r+this.positionStruct.startIndex+1];this._container.insertBefore(a,o),this.updateAttributeProviders(l)})}}_itemsDeleted(e,t){if(e==null)return;let n=[],s=Array.isArray(e)?e:[e];for(let r of s){let a=r.__uid;this._container.querySelectorAll([`[data-uid="${a}"]`]).forEach(o=>n.push(o)),crsbinding.data.removeObject(a)}for(let r of n)r!=null&&(r.parentElement.removeChild(r),crsbinding.observation.releaseBinding(r))}};var L=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a,!1)}dispose(){crsbinding.expression.release(this._expObj),delete this._expObj.parentObj,delete this._expObj,this._eventHandler=null,super.dispose()}async initialize(){this._sanitizeProperties=["fill","stroke"],this._eventHandler=this.propertyChanged.bind(this);let e;this._value.indexOf("?")==-1?e=this._initCndAttr():this._value.indexOf(":")!=-1?e=this._initCndValue():e=this._initCndAttrValue(),this._value.indexOf("$parent")!=-1&&(this._expObj.parentObj=crsbinding.data.getValue(this._parentId),e.properties.forEach(t=>{if(t.indexOf("$parent.")!=-1){let n=t.replace("$parent.",""),s=crsbinding.events.listenOnPath(this._parentId,n,this._eventHandler);this._cleanEvents=[...this._cleanEvents,s]}})),this.propertyChanged()}_initCndAttr(){let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=Me.split("__exp__").join(e.expression).split("__attr__").join(this._property).split("__attr-value__").join(this._property);return this._expObj=crsbinding.expression.compile(t,["element","parent"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties.filter(n=>n.indexOf("$parent")==-1),this._eventHandler),e}_initCndValue(){let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=e.expression.split("?"),n=t[1].split(":"),s=this._sanitizeValue(n[0].trim()),r=this._sanitizeValue(n[1].trim()),a=xt.split("__exp__").join(t[0].trim()).split("__attr__").join(this._property).split("__true__").join(s).split("__false__").join(r);return this._expObj=crsbinding.expression.compile(a,["element","parent"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties,this._eventHandler),e}_initCndAttrValue(){let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=e.expression.split("?"),n=Me.split("__exp__").join(t[0].trim()).split("__attr__").join(this._property).split("__attr-value__").join(t[1].trim());return this._expObj=crsbinding.expression.compile(n,["element","parent"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties,this._eventHandler),this.propertyChanged(),e}_sanitizeValue(e){return this._sanitizeProperties.indexOf(this._property)==-1?e:e.split("'").join("")}propertyChanged(){try{crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element,this._expObj.parentObj))}catch{return}}},Me=`
if (__exp__) {
    element.setAttribute("__attr__", "__attr-value__");
}
else {
    element.removeAttribute("__attr__");
}
`,xt=`
if (__exp__) {
    element.setAttribute("__attr__", __true__);
}
else {
    element.setAttribute("__attr__", __false__);
}
`;var H=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a)}dispose(){crsbinding.expression.release(this._expObj),delete this._expObj,this._eventHandler=null,super.dispose()}async initialize(){this._eventHandler=this.propertyChanged.bind(this);let e=this._value.split("?"),t=crsbinding.expression.sanitize(e[0],this._ctxName),n=t.expression,s=e[1].split(":"),r=s[0].trim(),a=s.length>1?s[1].trim():"[]",l=je.split("__property__").join(this._property).split("__exp__").join(n).split("__true__").join(r).split("__false__").join(a);this._expObj=crsbinding.expression.compile(l,["element"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(t.properties,this._eventHandler),this.propertyChanged()}propertyChanged(){try{crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element))}catch{return}}};var M=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a)}dispose(){crsbinding.expression.release(this._expObj),delete this._expObj,this._eventHandler=null,super.dispose()}async initialize(){this._eventHandler=this.propertyChanged.bind(this);let e=crsbinding.expression.sanitize(this._value,this._ctxName),t=e.expression.split("?"),n=t[0].trim(),s=t[1].split(":"),r=s[0].trim(),a=s.length>1?s[1].trim():'""',l=Pe.split("__property__").join(crsbinding.utils.capitalizePropertyPath(this._property)).split("__exp__").join(n).split("__true__").join(r).split("__false__").join(a);this._expObj=crsbinding.expression.compile(l,["element"],{sanitize:!1,ctxName:this._ctxName}),this.listenOnPath(e.properties,this._eventHandler),this.propertyChanged()}propertyChanged(){try{crsbinding.idleTaskManager.add(this._expObj.function(this.data,this._element))}catch{return}}};var O=class extends f{async initialize(){let e=this._value.split("("),t=e[0],n=["{"];e.length>0&&this._getParametersCode(e[1],n),n.push("}");let s=this._getSource(t,n.join(""));this._fn=new Function("context",s)}_getSource(e,t){return`crsbinding.events.emitter.emit("${e}", ${t});`}_getParametersCode(e,t){if(e==null)return;let n=e.split(")").join("").split(",");for(let s=0;s<n.length;s++){let a=n[s].trim();this[a]!=null?this[a](t):this._processArg(a,t),s<n.length-1&&t.push(",")}}$event(e){e.push("event: event")}$context(e){e.push("context: context")}_processArg(e,t){let n=e.split("="),s=n[0].trim(),r=this._processValue(n[1]);t.push(`${s}:${r}`)}_processValue(e){return e.indexOf("${")!=-1?e.split("${").join("context.").split("}").join(""):e}};var F=class extends O{async initialize(){let e=this._value.indexOf("["),t=this._value.indexOf("]"),n=this._value.substring(e+1,t).split(" ").join("").split(","),r=[`{key: "${this._value.substring(0,e).trim()}",`],a=this._value.indexOf("("),l=this._value.indexOf(")");if(a!=-1){let c=this._value.substring(a+1,l);this._getParametersCode(c,r)}r.push("}");let o=this._getSource(n,r.join(""));this._fn=new Function("context",o)}_getSource(e,t){let n=[];for(let s of e)s=s.split("'").join("").split('"').join(""),n.push(`crsbinding.events.emitter.postMessage("${s}", ${t});`);return n.join(`
`)}};var z=class extends f{async initialize(){let e=this._createSource();this._fn=new Function("context","event","setProperty",e)}_createSource(){if(this._value.trim()[0]!="[")return this._createSourceFrom(this._value);let e=[],n=this._value.substr(1,this._value.length-2).split(";");for(let s of n)e.push(this._createSourceFrom(s.trim()));return e.join(`
`)}_createSourceFrom(e){let t=e.split("="),n=this._processRightPart(t[1].trim());return this._processLeftPart(t[0].trim(),n)}_processRightPart(e){return crsbinding.expression.sanitize(e,this._ctxName,!0).expression}_processLeftPart(e,t){return e.indexOf("$globals")!=-1?this._getGlobalSetter(e,t):this._getContextSetter(e,t)}_getGlobalSetter(e,t){return`crsbinding.data.setProperty({_dataId: crsbinding.$globals}, "${e.replace("$globals.","")}", ${t});`}_getContextSetter(e,t){if(e=e.replace("$context.",""),t.indexOf("context.")!=-1){let n=t.split("context."),s=n[n.length-1];t=`${n[0]=="!"?"!":""}crsbinding.data.getValue({_dataId: ${this._context}}, "${s}")`}return`crsbinding.data.setProperty({_dataId: ${this._context}}, "${e}", ${t});`}event(e){let t=crsbinding.data.getContext(this._context);crsbinding.idleTaskManager.add(this._fn(t,e,this._setProperty)),e.stopPropagation()}_setProperty(e,t,n){n!==void 0&&crsbinding.data.setProperty(this,t,n)}};var V=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a),this._eventHandler=this.event.bind(this),this._element.addEventListener(this._property,this._eventHandler)}dispose(){this._element.removeEventListener(this._property,this._eventHandler),this._eventHandler=null,super.dispose()}event(){if(globalThis.crs?.process==null)return console.error("crs-process-api not present or running at this time");this._value[0]=="{"?vt(this):this._value.split("{")[0].indexOf("[")==-1?bt(this):yt(this)}};function vt(i){let e=ue(i._value,i._context),t=de(e,i._context),n=crsbinding.data.getContext(i._context);crs.process.runStep(t,n,null,null)}function bt(i){let t=ue(i._value,i._context).split("("),n=t[0].split("."),s=`{type: "${n[0]}", action: "${n[1]}", args: ${t[1]}}`.replace(")",""),r=de(s,i._context),a=crsbinding.data.getContext(i._context);crs.process.runStep(r,a,null,null)}function yt(i){let t=ue(i._value,i._context).split("["),n=t[0],s=t[1].replace("]","").split("("),r=s[0],a=Ct(s[1].replace(")","").trim(),i._context),o={context:crsbinding.data.getContext(i._context),step:{action:r,args:{schema:n}}};a!=null&&(o.parameters=a),crsbinding.events.emitter.emit("run-process",o)}function de(i,e){i.indexOf("{")==-1&&(i=`{${i}}`);let t=new Function("context",`return ${i};`),n=crsbinding.data.getContext(e),s=crsbinding.data.getData(e).data,r={};Object.assign(r,s),Object.assign(r,n);let a=t(r);return r=null,a}function Ct(i,e){return i.length==0?null:de(i,e)}function ue(i,e){return i.replace("bId",`bId: ${e}`).split("$context.").join("context.")}var R=class extends u{constructor(e,t,n,s,r,a){super(e,t,n,s,r,a,!1)}dispose(){this.clear(),this._element.removeEventListener("change",this._changeHandler),this._element.removeEventListener("click",this._clickHandler),this._changeHandler=null,this._clickHandler=null,this._eventHandler=null,this._perspectiveElement!=null&&(this._perspectiveElement.removeEventListener("view-loaded",this.viewLoadedHandler),this.viewLoadedHandler=null,this._perspectiveElement=null),super.dispose()}async initialize(){this._changeHandler=this._change.bind(this),this._clickHandler=this._click.bind(this),this._element.addEventListener("change",this._changeHandler),this._element.addEventListener("click",this._clickHandler),this._eventHandler=this.propertyChanged.bind(this),this._perspectiveElement=this._element.querySelector("perspective-element"),this._perspectiveElement!=null&&(this.viewLoadedHandler=this.viewLoaded.bind(this),this._perspectiveElement.addEventListener("view-loaded",this.viewLoadedHandler)),await this._initFields(this._perspectiveElement||this._element)}async viewLoaded(){this.clear(),await this._initFields(this._perspectiveElement)}async _change(e){let t=e.target.dataset.field;if(t==null)return;let n=e.target.value;e.target._converter!=null&&(t=e.target._converter.path,n=crsbinding.valueConvertersManager.get(e.target._converter.converter).set(n,e.target._converter.parameter));let s=e.target.type||"text",r=crsbinding.data.getValue(this._context,t);crsbinding.data._setContextProperty(this._context,t,n,{oldValue:r,ctxName:this._ctxName,dataType:s=="text"?"string":s}),e.stopPropagation()}async _click(e){e.target.dataset.action!=null&&await crsbinding.data.getContext(this._context)[e.target.dataset.action]?.(e)}async _initFields(e){this.inputs=this.inputs||{};let t=e.querySelectorAll("[data-field]");for(let n of t){let s=n.dataset.field;if(n.dataset.field.indexOf(":")!=-1){n._converter=m(n.dataset.field),s=n._converter.path;let r="null";n._converter.parameter!=null&&(r=`JSON.parse('${JSON.stringify(n._converter.parameter)}')`);let a=`return crsbinding.valueConvertersManager.convert(value, "${n._converter.converter}", "get", ${r})${n._converter.postExp}`;n._converter.fn=new Function("value",a)}this.inputs[s]=n,this.listenOnPath(s,this._eventHandler),await crsbinding.data.updateUI(this._context,s)}}propertyChanged(e,t){let n=this.inputs[e];n!=null&&n.value!=t&&(n._converter!=null&&(t=n._converter.fn(t)),n.value=t??"")}clear(){let e=Object.keys(this.inputs);for(let t of e)this.removeCallback(t);this.inputs=null}removeCallback(e){crsbinding.data.removeCallback(this._context,e,this._eventHandler),this.inputs[e]._converter.fn=null,this.inputs[e]._converter=null,delete this.inputs[e];let t=this._cleanEvents.filter(n=>n.path==e);if(t!=null){let n=this._cleanEvents.indexOf(t);delete t.callback,this._cleanEvents.splice(n,1)}}};var Ot=`
if (__expr__) {
    return element.classList.add(__value__);
}
`,Et="return element.classList.add(__value__);",B=class extends u{async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._properties=[],Pt.call(this),this.listenOnPath(this._properties,this._eventHandler),this.propertyChanged()}dispose(){this.properties=null,this.fn=null,this._eventHandler=null,super.dispose()}propertyChanged(){try{crsbinding.idleTaskManager.add(this.fn(this.data,this._element))}catch{return}}};function Pt(){let i=this._value.split(","),e=[],t=[];for(let r of i){let a=r.split(":"),l=this._property,o=a[1].trim();if(t.push(o),a[0].trim()=="default"){e.push(Et.replace("__attr__",l).replace("__value__",o));continue}let c=crsbinding.expression.sanitize(a[0].trim(),this._ctxName);this._properties=[...this._properties,...c.properties],e.push(Ot.replace("__expr__",c.expression).replace("__attr__",l).replace("__value__",o))}let n=new Set(this._properties);this._properties=Array.from(n);let s=`element.classList.remove(${t.join(",")});${e.join("")}`;this.fn=new x("context","element",s)}var wt=`
if (__expr__) {
    return element.__property__ = __value__;
}
`,Fe="return element.__property__ = __value__;",D=class extends u{async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._properties=[],$t.call(this),this.listenOnPath(this._properties,this._eventHandler),this.propertyChanged()}dispose(){this.properties=null,this.fn=null,this._eventHandler=null,super.dispose()}propertyChanged(){try{crsbinding.idleTaskManager.add(this.fn(this.data,this._element))}catch{return}}};function $t(){let i=this._value.split(","),e=[],t=!1;for(let s of i){let r=s.split(":"),a=r[1].trim();if(r[0].trim()=="default"){t=!0,e.push(Fe.replace("__property__",this._property).replace("__value__",a));continue}let l=crsbinding.expression.sanitize(r[0].trim(),this._ctxName);this._properties=[...this._properties,...l.properties],e.push(wt.replace("__expr__",l.expression).replace("__property__",this._property).replace("__value__",a))}t==!1&&e.push(Fe.replace("__property__",this._property).replace("__value__","'inherit'"));let n=new Set(this._properties);this._properties=Array.from(n),this.fn=new x("context","element",e.join(""))}var At=`
if (__expr__) {
    return element.setAttribute("__attr__", __value__);
}
`,jt='return element.setAttribute("__attr__", __value__);',q=class extends u{async initialize(){this._eventHandler=this.propertyChanged.bind(this),this._properties=[],Tt.call(this),this.listenOnPath(this._properties,this._eventHandler),this.propertyChanged()}dispose(){this.properties=null,this.fn=null,this._eventHandler=null,super.dispose()}propertyChanged(){try{crsbinding.idleTaskManager.add(this.fn(this.data,this._element))}catch{return}}};function Tt(){let i=this._value.split(","),e=[],t=!1;for(let s of i){let r=s.split(":"),a=this._property,l=r[1].trim();if(r[0].trim()=="default"){t=!0,e.push(jt.replace("__attr__",a).replace("__value__",l));continue}let o=crsbinding.expression.sanitize(r[0].trim(),this._ctxName);this._properties=[...this._properties,...o.properties],e.push(At.replace("__expr__",o.expression).replace("__attr__",a).replace("__value__",l))}t==!1&&e.push(`element.removeAttribute("${this._property}");`);let n=new Set(this._properties);this._properties=Array.from(n),this.fn=new x("context","element",e.join(""))}var E=class{static bind(e,t,n,s,r,a,l){return["value","checked"].indexOf(n)!=-1?new w(e,t,n,s,r,l):this["one-way"](e,t,n,s,r,l)}static dataset(e,t,n,s,r,a,l){return new R(e,t,n,s,r,l)}static"two-way"(e,t,n,s,r,a,l){return new w(e,t,n,s,r,l)}static"one-way"(e,t,n,s,r,a,l){return s[0]=="`"?new S(e,t,n,s,r,l):new y(e,t,n,s,r,l)}static once(e,t,n,s,r,a,l){return Le(e,t,n,s,r,l)}static call(e,t,n,s,r,a,l){return new f(e,t,n,s,r,l)}static delegate(e,t,n,s,r,a,l){return new f(e,t,n,s,r,l)}static emit(e,t,n,s,r,a,l){return new O(e,t,n,s,r,l)}static post(e,t,n,s,r,a,l){return new F(e,t,n,s,r,l)}static setvalue(e,t,n,s,r,a,l){return new z(e,t,n,s,r,l)}static inner(e,t,n,s,r,a,l){return new k(e,t,n,s,r,l)}static for(e,t,n,s,r,a,l){let o=a.name.split("."),c=o.length>1?crsbinding.providerManager.providers.for[o[1]]:null;return c!=null?new c(e,t,n,s,r,l):new N(e,t,n,s,r,l)}static if(e,t,n,s,r,a,l){return n.toLowerCase()=="classlist"?new H(e,t,n,s,r,l):n.toLowerCase().indexOf("style.")!=-1?new M(e,t,n,s,r,l):new L(e,t,n,s,r,l)}static attr(e,t,n,s,r,a,l){return new C(e,t,n,s,r,l)}static process(e,t,n,s,r,a,l){return new V(e,t,n,s,r,l)}static case(e,t,n,s,r,a,l){return n.toLowerCase()=="classlist"?new B(e,t,n,s,r,a,l):n.toLowerCase().indexOf("style.")!=-1?new D(e,t,n,s,r,a,l):new q(e,t,n,s,r,a,l)}};var It=["style","script"];async function U(i,e,t){for(let n of i||[])await crsbinding.parsers.parseElement(n,e,t)}async function ze(i,e,t){let n="context",s=null,r=null;if(t!=null&&(n=t.ctxName||"context",s=t.parentId||null,r=t.folder||null),i.__inflated==!0)return;let a=i.nodeName.toLowerCase();if(It.indexOf(a)!=-1)return;if(i.dataset?.dataset!=null&&E.dataset(i,e,null,null,n,null,s),a!="template"&&a!="perspective-element"&&i.children?.length>0&&await U(i.children,e,t),a=="template"&&i.getAttribute("src")!=null)return await Nt(i,e,t);let o=Array.from(i.attributes||[]).filter(c=>c.ownerElement.tagName.toLowerCase()=="template"&&c.name=="for"||c.name=="ref"||c.name.indexOf(".")!=-1||(c.value||"").indexOf("${")==0||(c.value||"").indexOf("&{")==0);if(await St(o,e,n,s),i.children&&i.children.length==0){let c=i.textContent||"";c.indexOf("&{")!=-1?i.textContent=await crsbinding.translations.get_with_markup(i.textContent):c.indexOf("${")!=-1&&E.inner(i,e,null,null,n,null,s)}else a==="svg"&&crsbinding.svgCustomElements.parse(i)}async function St(i,e,t,n){for(let s of i)s.nodeValue.indexOf("&{")!==-1?s.nodeValue=await crsbinding.translations.get_with_markup(s.nodeValue):await kt(s,e,t,n)}async function kt(i,e,t,n){if(i.name=="ref"){crsbinding.data._context[e][i.value]=i.ownerElement;return}let s=i.name.split("."),r=s.length==2?s[0]:s.slice(0,s.length-1).join("."),a=r=="for"?r:s[s.length-1];r.length==0&&i.value[0]=="$"&&(r=a,a="attr");let l=E[a](i.ownerElement,e,r,i.value,t,i,n);return(l==null||l.constructor.name!="AttrProvider"||i.nodeName.indexOf(".attr")!=-1)&&i.ownerElement.removeAttribute(i.nodeName),l}async function Nt(i,e,t){if(t?.folder==null)return;let n=crsbinding.utils.relativePathFrom(t.folder,i.getAttribute("src")),s=document.createElement("template");s.innerHTML=await fetch(n).then(l=>l.text());let r=s.content.cloneNode(!0);await U(r.children,e,t);let a=i.parentElement;a.insertBefore(r,i),a.removeChild(i)}function pe(i){crsbinding.providerManager.releaseElement(i)}function Ve(i){for(let e of i.children)pe(e)}function Re(i,e,t,n,s="context",r){n.indexOf("$parent.")!=-1&&(n=n.split("$parent.").join(""),e=r);let a=b(n),l=a.singular,o=a.plural,c=`for-once-${l}`;crsbinding.inflationManager.register(c,i,l);let h=crsbinding.data.getValue(e,o),p=crsbinding.inflationManager.get(c,h);crsbinding.inflationManager.unregister(c),i.parentElement.appendChild(p),i.parentElement.removeChild(i)}var K=class extends g{dispose(){super.dispose()}async _renderItems(e){await super._renderItems();let t=document.createDocumentFragment(),n=e.keys();for(let s of n){let r=e.get(s);r.__aId=s,t.appendChild(await this.createElement(r,s))}this.positionStruct.addAction(t),this._container.__providers==null&&(this._container.__providers=[]),this._container.__providers.indexOf(this.id)==-1&&this._container.__providers.push(this.id)}};var W=class extends u{dispose(){for(let e of this.inputs)e.removeEventListener("change",this._changeHandler);this.inputs=null,this._changeHandler=null,this._propertyToSet=null,super.dispose()}async initialize(){this._propertyToSet=this._element.getAttribute("property"),this._changeHandler=this._change.bind(this);let e=this._value.split("of"),t=e[0].trim(),n=e[1].trim(),s=`for-group-${t}`;crsbinding.inflationManager.register(s,this._element,t);let r=crsbinding.data.getValue(this._context,n),a=crsbinding.inflationManager.get(s,r);crsbinding.inflationManager.unregister(s);let l=crsbinding.data.getProperty(this._context,this._propertyToSet);this.inputs=a.querySelectorAll("input");for(let o of this.inputs)o.setAttribute("type","radio"),o.setAttribute("name",n),o.addEventListener("change",this._changeHandler),l&&o.getAttribute("value")==l.toString()&&o.setAttribute("checked","checked");this._element.parentElement.appendChild(a),this._element.parentElement.removeChild(this._element)}async _change(e){crsbinding.data.setProperty(this._context,this._propertyToSet,e.target.value)}};var Y=class extends u{dispose(){crsbinding.inflationManager.unregister(this.key),this._collectionChangedHandler=null,this._parentElement=null,this.singular=null,this.plural=null,this.key=null,super.dispose()}async initialize(){this._parentElement=this._element.parentElement,this.clear();let e=b(this._value);if(this.singular=e.singular,this.plural=e.plural,this.key=this._element.dataset.id,this.key==null){console.error("for.inflate must have a data-id attribute");return}crsbinding.inflationManager.register(this.key,this._element,this.singular),this._collectionChangedHandler=this._collectionChanged.bind(this),this.listenOnPath(this.plural,this._collectionChangedHandler)}async _collectionChanged(e,t){if(t==null)return this._clear();let n=crsbinding.inflationManager.get(this.key,t,this._parentElement.children);n?.childElementCount>0&&this._parentElement.appendChild(n);let s=this._parentElement.querySelectorAll("[remove='true']");for(let r of s)this._parentElement.removeChild(r)}clear(){this._parentElement.innerHTML=""}};var J=class{constructor(){this._nextId=0,this.items=new Map,this.providers={for:{map:K,once:Re,radio:W,inflate:Y}}}async register(e){e.id=this._nextId,e._element.__providers==null&&Reflect.set(e._element,"__providers",[]),e._element.__providers.push(this._nextId),this.items.set(this._nextId,e),this._nextId+=1}async releaseElement(e){e.nodeName?.toLowerCase()=="svg"&&crsbinding.svgCustomElements.release(e);for(let t of e.__cleanup||[])e[t]=null;for(let t of e.children||[])await this.releaseElement(t);if(e.__providers!=null){for(let t of e.__providers){let n=this.items.get(t);this.items.delete(t),n&&n.dispose(),n=null}delete e.__providers,this.items.size==0&&(this._nextId=0)}}};globalThis.requestIdleCallback=globalThis.requestIdleCallback||function(i){let e=Date.now();return setTimeout(function(){i({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-e))}})},1)};globalThis.cancelIdleCallback=globalThis.cancelIdleCallback||function(i){clearTimeout(i)};var G=class{constructor(){this.processing=!1,this._list=[]}dispose(){this._list=null}async add(e){if(typeof e=="function"){if(requestIdleCallback==null)return await e();this._list.push(e),this.processing!=!0&&await this._processQueue()}}async _processQueue(){this.processing=!0;try{requestIdleCallback(async()=>{for(;this._list.length>0;){let e=this._list.shift();try{await e()}catch(t){console.error(t)}}},{timeout:1e3})}finally{this.processing=!1}}};function Be(i,e,t){typeof i=="object"&&(i=i.__uid||i._dataId);let n=Array.isArray(e)==!0?e:[e],s=[];for(let r of n)r.indexOf("$globals.")!=-1&&(i=crsbinding.$globals,r=r.replace("$globals.",""),qe(s,crsbinding.$globals,r,t)),Lt(i,r,t,s);return s}function De(i){for(let e of i)crsbinding.data.removeCallback(e.context,e.path,e.callback),delete e.context,delete e.path,delete e.callback;i.length=0}function Lt(i,e,t,n){crsbinding.data.addCallback(i,e,t),qe(n,i,e.split("$parent.").join("").split("$context.").join(""),t)}function qe(i,e,t,n){i.push({context:e,path:t,callback:n})}function Ue(i){i._domEvents=[],i.registerEvent=Ht,i.unregisterEvent=Mt}function Ke(i){if(i._domEvents!=null){for(let e of i._domEvents)i.removeEventListener(e.event,e.callback),delete e.element,delete e.callback,delete e.event;i._domEvents.length=0,delete i._domEvents,delete i.registerEvent,delete i.unregisterEvent}}function Ht(i,e,t,n=null){i.addEventListener(e,t,n),this._domEvents.push({element:i,event:e,callback:t})}function Mt(i,e,t){let n=this._domEvents.find(s=>s.element==i&&s.event==e&&s.callback==t);n!=null&&(i.removeEventListener(n.event,n.callback),this._domEvents.splice(this._domEvents.indexOf(n),1),delete n.element,delete n.callback,delete n.event)}var Q=class{constructor(){this._items=new Map}dispose(){this._items.clear(),this._items=null}async register(e,t,n="context",s=!1){t=t.cloneNode(!0);let r=new _e(n,e),a=await r.generateCodeFor(t),l=r.templateKeys;r.dispose(),crsbinding.elementStoreManager.register(e,t,s),this._items.set(e,{id:e,childCount:a.childCount,inflate:a.inflate,deflate:a.deflate,templates:l})}unregister(e){let t=this._items.get(e);t!=null&&(t.inflate=null,t.defaulte=null,t.templates!=null&&t.templates.forEach(n=>this.unregister(n)),this._items.delete(e)),crsbinding.elementStoreManager.unregister(e)}get(e,t,n,s){t==null&&console.error("inflation manager - get, data may not be null");let r=this._items.get(e);if(r==null)return null;if(n!=null)return this._getWithElements(r,t,n,s||0);let a=Array.isArray(t)?t.length*r.childCount:1,l=crsbinding.elementStoreManager.getElements(e,a);return this._inflateElements(r,l,t),l}_getWithElements(e,t,n,s){if(t.length==0)return null;let r=n.length-t.length*e.childCount,a=null;if(r<0){let c=-1*r;a=crsbinding.elementStoreManager.getElements(e.id,c);let h=c/e.childCount,p=t.length-h,le=t.slice(p,t.length);this._inflateElements(e,a,le),t=t.slice(0,p)}let l=0,o=[];for(let c of t){o.length=0;let h=s*e.childCount+l*e.childCount;for(let p=0;p<e.childCount;p++)o.push(n[h+p]);e.inflate(o.length>1?o:o[0],c),l+=1}if(s==0&&r>0){o=Array.from(n);for(let c=r;c>0;c--){let h=o.pop();h.parentElement.removeChild(h)}}return a}_inflateSingleElement(e,t,n){this.inflate(e.id,e.childCount==1?t.children[0]:Array.from(t.children),n,e.inflate)}_inflateSingleChildFragment(e,t,n){let s=Array.isArray(t);n=Array.isArray(n)?n:[n];for(let r=0;r<n.length;r++){let a=s?t[r]:t.children[r];this.inflate(e.id,a,n[r],e.inflate),a.__inflated=!0;let l=Array.from(a.attributes).filter(o=>o.name.indexOf(".attr")!=-1);for(let o of l)a.removeAttribute(o.name)}}_inflateMultiChildFragment(e,t,n){let s=Array.from(t.children),r=0;for(let a=0;a<n.length;a++){let l=s.slice(r,r+e.childCount);this.inflate(e.id,l,n[a],e.inflate,!1),r+=e.childCount}s.forEach(a=>{a.__inflated=!0;let l=Array.from(a.attributes).filter(o=>o.name.indexOf(".attr")!=-1);for(let o of l)a.removeAttribute(o.name)}),s.filter(a=>a.getAttribute("remove")=="true").forEach(a=>a.parentNode.removeChild(a))}_inflateElements(e,t,n){Array.isArray(n)==!1?this._inflateSingleElement(e,t,n):e.childCount==1?this._inflateSingleChildFragment(e,t,n):this._inflateMultiChildFragment(e,t,n)}inflate(e,t,n,s=null,r=!0){(s||this._items.get(e).inflate)(t,n),r==!0&&this._removeElements(t)}_removeElements(e){let t=[];Array.isArray(e)?e.forEach(n=>{let s=n.querySelectorAll('[remove="true"]');s.length>0&&(t=[...t,...s])}):t=e.querySelectorAll('[remove="true"]');for(let n of t)n.parentElement.removeChild(n)}deflate(e,t){let n=this._items.get(e).deflate;if(Array.isArray(t))for(let s of t)n(s);else n(t)}returnElements(e,t,n=!1){crsbinding.elementStoreManager.returnElements(e,t,n)}},_e=class{constructor(e,t){this.parentKey=t,this.templateKeys=[],this.inflateSrc=[],this.deflateSrc=[],this._ctxName=e}dispose(){this.inflateSrc=null,this.deflateSrc=null}async generateCodeFor(e){let t=e.content==null?e.children:e.content.children,n=t.length;if(n==1){this.path="element";for(let a of t)await this._processElement(a)}else for(let a=0;a<t.length;a++)this.path=`element[${a}]`,await this._processElement(t[a]);let s=this.inflateSrc.join(`
`),r=this.deflateSrc.join(`
`);return{childCount:n,inflate:new Function("element",this._ctxName,s),deflate:new Function("element",this._ctxName,r)}}async _processElement(e){this._clearAttributes(e),await this._processTextContent(e),await this._processAttributes(e);let t=this.path;for(let n=0;n<e.children.length;n++){let s=e.children[n];s.nodeName=="TEMPLATE"?this._processTemplate(s):(this.path=`${t}.children[${n}]`,await this._processElement(e.children[n]))}}_processTemplate(e){let t=`${this.parentKey}_${this.templateKeys.length+1}`;this.templateKeys.push(t),e.dataset.key=t;let n=e.getAttribute("for.once");if(n!=null){let s=b(n),r=`${this.path}.appendChild(crsbinding.inflationManager.get("${t}", ${s.plural}));`;this.inflateSrc.push(r),crsbinding.inflationManager.register(t,e,s.singular),e.parentElement.removeChild(e)}}async _processTextContent(e){if(e.children==null||e.children.length>0||e.textContent.indexOf("${")==-1&&e.textContent.indexOf("&{")==-1)return;let t=(e.innerHTML||"").trim(),n="textContent",s=t;if(s.indexOf("&amp;{")!=-1){let r=s.replace("&amp;{","").replace("}",""),a=await crsbinding.translations.get(r);a==null?this.inflateSrc.push(`crsbinding.translations.get("${r}").then(result => ${this.path}.textContent = result);`):this.inflateSrc.push(`${this.path}.textContent = "${a}"`)}else{let r=null;s.indexOf(":")!=-1&&(r=m(s));let a=crsbinding.expression.sanitize(r?.path||s,this._ctxName);if(s=a.expression,a.isHTML==!0&&(n="innerHTML"),r!=null){let l="null";r.parameter!=null&&(l=`JSON.parse('${JSON.stringify(r.parameter)}')`),s=`crsbinding.valueConvertersManager.convert(${a.expression}, "${r.converter}", "get", ${l})${r.postExp}`,this.inflateSrc.push(`${this.path}.${n} = ${s}`)}else this.inflateSrc.push([`${this.path}.${n} = \``+s+"`"].join(" "))}this.deflateSrc.push(`${this.path}.${n} = "";`)}async _processAttributes(e){for(let t of e.attributes)t.name.indexOf(".attr")!=-1?this._processAttr(t):t.value.indexOf("${")!=-1?this._processAttrValue(t):t.value.indexOf("&{")!=-1?await this._processTranslationValue(t):t.value.indexOf(".if")!=-1?this._processAttrCondition(t):this.inflateSrc.push(`${this.path}.setAttribute("${t.name}", "${t.value}")`)}_clearAttributes(e){this.inflateSrc.push(`while(${this.path}.attributes.length > 0) { ${this.path}.removeAttribute(${this.path}.attributes[0].name) };`);let t=e.getAttribute("class");this.inflateSrc.push(`${this.path}.removeAttribute("class");`)}_processAttr(e){let t=e.name.replace(".attr",""),n=crsbinding.expression.sanitize(e.value,this._ctxName).expression;this.inflateSrc.push(`${this.path}.setAttribute("${t}", ${n})`)}_processAttrValue(e){let t=e.value.trim(),n=t.substr(2,t.length-3);if(n=crsbinding.expression.sanitize(n,this._ctxName).expression,e.name=="xlink:href")this.inflateSrc.push(`${this.path}.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", ${n});`);else{let s=n.split("?");this.inflateSrc.push(`if (${s[0].trim()} != null) {${this.path}.setAttribute("${e.name}", ${n});}`)}this.deflateSrc.push(`${this.path}.removeAttribute("${e.name}");`),e.ownerElement.removeAttribute(e.name)}async _processTranslationValue(e){let t=e.value.replace("&{","").replace("}",""),n=await crsbinding.translations.get(t);n==null?this.inflateSrc.push(`crsbinding.translations.get("${t}").then(result => ${this.path}.setAttribute("${e.name}", result);`):this.inflateSrc.push(`${this.path}.setAttribute("${e.name}", "${n}");`)}_processAttrCondition(e){if(e.name.trim().indexOf("style.")==0)return this._processStyle(e);if(e.name.trim().indexOf("classlist")==0)return this._processClassList(e);if(e.name.trim().indexOf(".if")!=-1)return this._processConditional(e)}_processStyle(e){let t=e.name.split("."),n=crsbinding.utils.capitalizePropertyPath(t[1]),s=crsbinding.expression.sanitize(e.value.trim(),this._ctxName).expression;this.inflateSrc.push(`${this.path}.style.${n} = ${s};`),this.deflateSrc.push(`${this.path}.style.${n} = "";`),e.ownerElement.removeAttribute(e.name)}_processClassList(e){let t=e.value.split("?"),n=crsbinding.expression.sanitize(t[0],this._ctxName).expression,s=t[1].split(":"),r=s[0].trim(),a=s.length>1?s[1].trim():"",l=r.indexOf("[")==-1?r:`...${r}`,o=`if (${n}) {${this.path}.classList.add(${l});}`;if(a.length>0){let h=a.indexOf("[")==-1?a:`...${a}`;o+=`else {${this.path}.classList.add(${h});}`}let c=`while (${this.path}.classList.length > 0) {${this.path}.classList.remove(${this.path}.classList.item(0));}`;this.inflateSrc.push(o),this.deflateSrc.push(c),e.ownerElement.removeAttribute(e.name)}_processConditional(e){let t=e.name.split(".if")[0].trim(),n=e.value.split("?"),r=[`if(${crsbinding.expression.sanitize(n[0].trim(),this._ctxName).expression})`],a=n.length>1?n[1].trim():`"${t}"`;if(a.indexOf(":")==-1)r.push("{"),r.push(`${this.path}.setAttribute("${t}", ${a});`),r.push("}"),r.push(`else {${this.path}.removeAttribute("${t}")}`);else{let l=n[1].split(":");r.push("{"),r.push(`${this.path}.setAttribute("${t}", ${l[0].trim()});`),r.push("}"),r.push(`else {${this.path}.setAttribute("${t}", ${l[1].trim()})}`)}this.inflateSrc.push(r.join("")),this.deflateSrc.push(`${this.path}.removeAttribute("${t}")`),e.ownerElement.removeAttribute(e.name)}};function We(i){return i==null?i:Ye(Object.assign({},i))}function Ye(i){let e=Object.getOwnPropertyNames(i).filter(t=>t.indexOf("__")==0);for(let t of e)delete i[t];e=Object.getOwnPropertyNames(i).filter(t=>t.indexOf("__")==-1&&typeof i[t]=="object");for(let t of e)Ye(i[t]);return i}function _(i,e){let t=i;if(e.indexOf(".")==-1)return t[e];let n=e.split(".");for(let s=0;s<n.length-1;s++){let r=n[s];if(t=t[r],t==null)return null}return t[n[n.length-1]]}function fe(i,e,t){return i==null?null:(i.__id=e,i.__property=t,new Proxy(i,{get:Vt}))}var Ft=["pop","splice"],zt=["push"];function Vt(i,e){let t=i[e];return typeof t=="function"?(...n)=>{let s=i[e](...n);return Ft.indexOf(e)!=-1?(Rt(i,s),e=="splice"&&n.length>2&&(n=n.splice(2,n.length),Je(i,n))):zt.indexOf(e)!=-1&&Je(i,n),s}:t}function Rt(i,e){let t=i.__id,n=i.__property;crsbinding.data.arrayItemsRemoved(t,n,e,i)}function Je(i,e){let t=i.__id,n=i.__property;crsbinding.data.arrayItemsAdded(t,n,e,i)}var X=class{constructor(){this._data={},this._converters={},this._callbacks={},this._updates={},this._triggers=new Map,this._context={},this._sync={},this._frozenObjects=[],this._idStore={nextId:0,nextTriggerId:0,nextArrayId:0,nextSyncId:0}}getConverter(e,t){let n=this._converters[e];if(n==null)return null;let s=_(n,t);return s==null?null:crsbinding.valueConvertersManager.get(s)}_getContextId(e){return typeof e=="object"?e.__uid||e._dataId:e}getContext(e){return this._context[e]}getData(e){return this._data[e]}array(e,t){e=this._getContextId(e);let n=this.getValue(e,t);return fe(n,e,t)}setName(e,t){this._data[e].name=t}addObject(e,t={}){let n=this._getNextId();return t.contextId=n,this._data[n]={name:e,type:"data",data:t},this._callbacks[n]={},n}removeObject(e){delete this._context[e];let t=this._removeData(e);return this._removeCallbacks(e),this._removeUpdates(e),this._removeTriggers(e),this._removeSync(e),this._removeConverters(e),t}getValue(e,t,n=!0){if(e=="undefined"||e==null)return;e=this._getContextId(e),t!=null&&t.indexOf("$globals.")!==-1&&(e=crsbinding.$globals,t=t.replace("$globals.",""));let s=this._data[Number(e)],r;if(s.type=="data"){let a=s.data;if(t==null)return a;r=t.indexOf(".")===-1?a[t]:_(a,t)}else{let a=s.refId;r=this._getReferenceValue(a,t,s.path,s.aId)}if(n==!0){let a=this.getConverter(e,t);a!=null&&(r=a.get(r))}return r}makeShared(e,t,n){e=this._getContextId(e);let s=this._callbacks[e];for(let r of n){let a=`${t}.${r}`;this._ensurePath(s,a,(l,o)=>{l[o]==null&&(l[o]={});let c=this._getNextTriggerId();this._triggers.set(c,{values:[{id:e,path:a}]}),l[o].__trigger=c})}}getProperty(e,t,n=!0){e=this._getContextId(e);let s=this.getValue(e,t,n);return Array.isArray(s)&&(s=fe(s,e,t)),s}setProperty(e,t,n,s=!0){e=this._getContextId(e);let r=this.getProperty(e,t,!1);Array.isArray(r)&&(this.array(e,t).splice(0,r.length),n!=null&&(r.__syncId!=null?n.__syncId=r.__syncId:delete n.__syncId)),n&&n.__uid!=null&&r&&this._unlinkArrayItem(r),this._setContextProperty(e,t,n,{oldValue:r,convert:s}),n&&n.__uid&&this.linkToArrayItem(e,t,n.__uid)}_setContextProperty(e,t,n,s){let r=s.oldValue,a=s.ctxName,l=s.dataType,o=s.convert||!0;e=this._getContextId(e);let c=this._data[e];if(!(c==null||c.__frozen==!0)){if(o==!0){let h=this.getConverter(e,t);h!=null&&(n=h.set(n))}l==="boolean"||typeof n=="boolean"?n=Boolean(n):(l==="number"||l==null&&typeof n!="object"&&isNaN(n)==!1&&n!="")&&(n=Number(n)),c.type=="data"?(c=this._data[e].data,(t.indexOf(".")===-1?this._setObjectProperty(c,t,n):this._setObjectPropertyPath(c,t,n))==!0&&(this._performUpdates(e,t,n,r),this.updateUI(e,t))):this._setReferenceValue(e,t,n,c.refId,c.path,c.aId,a)}}_setReferenceValue(e,t,n,s,r,a,l){let o=this._data[s];if(o.type=="data"){let c=_(o.data,r),h=c.__syncId;a!=null&&(c=c.find(p=>p.__aId==a)),l!="context"&&(t=t.split(`${l}.`).join("")),this._setObjectPropertyPath(c,t,n),h!=null&&this._frozenObjects.indexOf(c)===-1&&this._setSyncValues(h,t,n,c),this._callFunctionsOnPath(e,t)}else{let c=`${o.path}.${path}`;return this._getReferenceValue(o.refId,t,c)}}createReferenceTo(e,t,n,s){let r=this._getNextId(),a={id:r,name:t,type:"ref",refId:e,path:n};return s!==void 0&&(a.aId=s),this._data[r]=a,this._callbacks[r]={},r}_getReferenceValue(e,t,n,s){let r=this._data[e];if(r.type=="data")if(s===void 0){let a=t==null?n:`${n}.${t}`;return this.getValue(e,a)}else{let a=this.getValue(e,n),l;if(Array.isArray(a))l=a.find(o=>o.__aId==s);else{let o=a.get(s);l={key:s,value:o}}return t==null||l==null?l:_(l,t)}else{let a=`${r.path}.${n}`;return this._getReferenceValue(r.refId,t,a)}}_getNextId(){return this._nextId("nextId")}_getNextTriggerId(){return this._nextId("nextTriggerId")}nextArrayId(){return this._nextId("nextArrayId")}_nextId(e){let t=this._idStore[e];return this._idStore[e]+=1,t}createArraySync(e,t,n,s){let r=this.getValue(e,t),a=this._idStore.nextSyncId;this._idStore.nextSyncId+=1;let l={primaryKey:n,fields:s,collection:[]};return this._sync[a]=l,this.addArraySync(a,e,t,r)}removeArraySync(e,t,n){let s=this._sync[e];if(t=this._getContextId(t),s!=null){s.collection.filter(l=>l.id==t&&l.path==n).forEach(l=>s.collection.splice(s.collection.indexOf(l),1)),s.collection.length==0&&delete this._sync[e];let a=this.getValue(t,n);a!=null&&(delete a.__syncId,a.filter(l=>l.__syncId==e).forEach(l=>delete l.__syncId))}}addArraySync(e,t,n,s){return new Promise(r=>{t=this._getContextId(t),this._ensurePath(t,n,()=>{let a=this._sync[e];if(a.collection.filter(l=>l.id==t&&l.path==n).length>0)return r(e);a.collection.push({id:t,path:n}),s==null&&(s=this.getValue(t,n)),s.__syncId=e,r(e)})})}_setSyncValues(e,t,n,s){this._frozenObjects.push(s);let r=this._sync[e];if(r.fields.indexOf(t)!==-1){let a=s[r.primaryKey];for(let l of r.collection){let c=this.getValue(l.id,l.path).find(h=>h[r.primaryKey]==a);this._frozenObjects.push(c),c!=s&&this.setProperty(c,t,n)}}this._frozenObjects.length=0}addContext(e,t){this._context[e]=t}addCallback(e,t,n){let s=this._callbacks[e];return t.indexOf(".")===-1?this._addCallbackToObject(s,t,n):this._addCallbackToObjectOnPath(s,t,n)}_addCallbackToObject(e,t,n){e[t]=e[t]||{},e[t].__functions=e[t].__functions||[],e[t].__functions.push(n)}_addCallbackToObjectOnPath(e,t,n){this._ensurePath(e,t,(s,r)=>{this._addCallbackToObject(s,r,n)})}_ensurePath(e,t,n){let s=e,r=t.split(".");for(let a=0;a<r.length-1;a++){let l=r[a];s[l]==null&&(s[l]={}),s=s[l]}n&&n(s,r[r.length-1])}removeCallback(e,t,n){let s=this._callbacks[e];if(s==null)return;let r=_(s,t);if(r.__functions){let a=r.__functions.indexOf(n);a!==-1&&(r.__functions.splice(a,1),r.__functions.length==0&&delete r.__functions)}}async updateUI(e,t){e=this._getContextId(e);let n=this._callbacks[e];if(t==null){let s=this._getOwnProperties(n);for(let r of s)await this._callFunctionsOnObject(n[r],e,r)}else{if(t.indexOf(".")!==-1)return this._callFunctionsOnPath(e,t);if(n==null||n[t]==null)return;await this._callFunctionsOnObject(n[t],e,t)}}async _callFunctionsOnObject(e,t,n){if(e.__functions!=null)for(let a of e.__functions){let l=this.getValue(t,n);await a(n,l)}if(e.__trigger!=null){let a=this._triggers.get(e.__trigger);if(a.frozen!=!0){a.frozen=!0;for(let l of a.values)l.id==t&&l.path==n||await this.updateUI(l.id,l.path);delete a.frozen}}let r=this._getOwnProperties(e);for(let a of r)await this._callFunctionsOnObject(e[a],t,`${n}.${a}`)}async _callFunctionsOnPath(e,t){let n=this._callbacks[e],s=_(n,t);s!=null&&await this._callFunctionsOnObject(s,e,t)}async _performUpdates(e,t,n,s){this._performUpdatesChanges(e,t,n);let r=this._context[e];if(r==null)return;let a=`${t}Changed`;r[a]?await r[a](n,s):r.propertyChanged&&await r.propertyChanged(t,n,s)}_performUpdatesChanges(e,t,n){let s=this._updates[e];s==null||s[t]==null||this.setProperty(s[t].originId,s[t].originProperty,n)}link(e,t,n,s,r){typeof r!="object"||r===null?(this._addUpdateOrigin(e,t,n,s),this._addUpdateOrigin(n,s,e,t),this._syncValueTrigger(e,t,n,s)):this._syncTriggers(e,t,n,s)}linkToArrayItem(e,t,n){let s=_(this._callbacks[e],t);if(s==null)return;let r=this._callbacks[n],a=this._getOwnProperties(s);for(let l of a)this._copyTriggers(s,l,r,l,n,l)}_addUpdateOrigin(e,t,n,s){let r=this._updates[n]||{},a=r[s]||{};a.originId==e&&a.originProperty==t||(a.originId=e,a.originProperty=t,r[s]=a,this._updates[n]=r)}_unlinkArrayItem(e){let t=this._callbacks[e.__uid];this._removeTriggersOnCallbacks(t,e.__uid)}setArrayEvents(e,t,n,s){let r=this._callbacks[e];this._ensurePath(r,t,(a,l)=>{a[l]=a[l]||{},a[l].__itemsAdded=a[l].itemsAdded||[],a[l].__itemsAdded.push(n),a[l].__itemsDeleted=a[l].itemsDeleted||[],a[l].__itemsDeleted.push(s)})}arrayItemsAdded(e,t,n,s){let r=this._callbacks[e],a=_(r,t);if(a!=null)for(let l of a.__itemsAdded||[])l(n,s)}arrayItemsRemoved(e,t,n,s){let r=this._callbacks[e],a=_(r,t);if(a!=null)for(let l of a.__itemsDeleted||[])l(n,s)}_copyTriggers(e,t,n,s,r,a){let l=e[t],o=n[s]=n[s]||{};l.__trigger!=null&&(o.__trigger=l.__trigger,this._triggers.get(l.__trigger).values.push({id:r,path:a}));let c=this._getOwnProperties(l);for(let h of c)this._copyTriggers(l,h,o,h,r,`${a}.${h}`)}_removeData(e){let t=this._removeReferences(e);return delete this._data[e],Object.keys(this._data).length==0&&(this._idStore.nextId=1,this._idStore.nextArrayId=0),t.push(e),t}_removeReferences(e){let t=[],n=Object.keys(this._data);for(let s of n){let r=this._data[s];r.refId==e&&(t.push(r.id),this.removeObject(r.id))}return t}_removeCallbacks(e){delete this._callbacks[e]}_removeUpdates(e){let t=Array.from(this._updates).filter(n=>n[0]==e||n[1].value&&n[1].value.originId==e);for(let n of t)delete this._updates[n[0]]}_removeTriggers(e){let t=Array.from(this._triggers);for(let n of t){let s=n[1].values.findIndex(r=>r.id==e);s!=-1&&(n[1].values.splice(s,1),n.values.length==0&&this._triggers.delete(n[0]))}this._triggers.size==0&&(this._idStore.nextTriggerId=0)}_removeSync(e){let t=Object.keys(this._sync);for(let n of t){let s=this._sync[n];s.collection.filter(a=>a.id==e).forEach(a=>s.collection.splice(s.collection.indexOf(a),1)),s.collection.length==0&&delete this._sync[n]}}_removeConverters(e){delete this._converters[e]}_setObjectProperty(e,t,n){return e[t]!==n?(e[t]=n,!0):!1}_setObjectPropertyPath(e,t,n){let s=!0;return this._ensurePath(e,t,(r,a)=>s=this._setObjectProperty(r,a,n)),s}_getOwnProperties(e){return Object.getOwnPropertyNames(e).filter(t=>t.indexOf("__")===-1)}_removeTriggersOnCallbacks(e,t){let n=this._getOwnProperties(e);for(let s of n){let r=e[s].__trigger;r!=null&&(delete e[s].__trigger,this._removeTriggersOnTriggers(t,r)),typeof e[s]=="object"&&this._removeTriggersOnCallbacks(e[s])}}_removeTriggersOnTriggers(e,t){let n=this._triggers.get(t),s=n.values.filter(r=>r.id==e);for(let r of s){let a=n.values.indexOf(r);n.values.splice(a,1)}}_syncValueTrigger(e,t,n,s){let r=this._callbacks[e],a=this._callbacks[n],l=_(r,`${t}.__trigger`);l!=null&&(a[s]=a[s]||{},a[s].__trigger=l,this._triggers.get(l).values.push({id:n,path:s}))}_syncTriggers(e,t,n,s){let r=this._callbacks[e],a=this._callbacks[n];t.indexOf(".")===-1?this._copyTriggers(r,t,a,s,n,s):this._ensurePath(a,s,(l,o)=>{l[o]=l[o]||{};let c=t.split("."),h=c[c.length-1],p=c.splice(0,c.length-1).join(),le=_(r,p);this._copyTriggers(le,h,l,o,n,s)})}setPropertyConverter(e,t,n,s){if(n!=null){e=this._getContextId(e);let r=this._converters[e];r==null&&(r={},this._converters[e]=r),this._ensurePath(r,t,(a,l)=>{a[l]=n})}s!=null&&this.setPropertyConverterTriggers(e,t,s)}setPropertyConverterTriggers(e,t,n){e=this._getContextId(e);let s=[];for(let a of n){let l=a.split(":"),o=l[0],c=l[1];this.setPropertyConverter(e,o,c),s.push(`crsbinding.data.setProperty(${e}, "${o}", value);`)}let r=new Function("property","value",s.join(`
`));this.addCallback(e,t,r)}};var Z=class{constructor(){this._events=new Map}dispose(){this._events.clear()}async on(e,t){let n=[];this._events.has(e)?n=this._events.get(e):this._events.set(e,n),n.indexOf(t)==-1&&n.push(t)}async emit(e,t){if(this._events.has(e)){let n=this._events.get(e);if(n.length==1)return await n[0](t);for(let s of n)await s(t)}}async remove(e,t){if(this._events.has(e)){let n=this._events.get(e),s=n.indexOf(t);s!=-1&&n.splice(s,1),n.length===0&&this._events.delete(e)}}async postMessage(e,t,n){let s=n||document,r=Array.from(s.querySelectorAll(e)),a=[];for(let l of r)a.push(l.onMessage.call(l,t));await Promise.all(a)}};function Ge(i){let e=i.mobi;return e!=null&&/Mobi/.test(navigator.userAgent)?e:i.html}var ee=class extends HTMLElement{get hasOwnContext(){return!0}constructor(){super(),this.attachShadow({mode:"open"}),this.hasOwnContext==!0&&(this._dataId=crsbinding.data.addObject(this.constructor.name),crsbinding.data.addContext(this._dataId,this)),crsbinding.dom.enableEvents(this),this.__properties=new Map}dispose(){this._disposing=!0,crsbinding.utils.forceClean(this),crsbinding.dom.disableEvents(this);let e=Object.getOwnPropertyNames(this);for(let t of e)delete this[t]}async connectedCallback(){if(!(this._dataId==null||this.__isLoading==!0)){if(this.__isLoading=!0,this.preLoad!=null){let e=(t,n)=>{crsbinding.data.setProperty(this._dataId,t,n)};await this.preLoad(e)}if(this.html!=null){this.shadowRoot.innerHTML=await crsbinding.templates.get(this.constructor.name,Ge(this)),this.onHTML!=null&&await this.onHTML();let e=crsbinding.utils.getPathOfFile(this.html);await crsbinding.parsers.parseElements(this.children,this._dataId,e?{folder:e}:null),await crsbinding.parsers.parseElements(this.shadowRoot.children,this._dataId,e?{folder:e}:null)}requestAnimationFrame(()=>{let e=this.getAttribute("name");e!=null&&crsbinding.data.setName(this._dataId,e)}),this.__properties.forEach((e,t)=>crsbinding.data.setProperty(this._dataId,t,e)),this.__properties.clear(),delete this.__properties,this.load!=null&&this.load(),this.isReady=!0,this.dispatchEvent(new CustomEvent("ready")),delete this.__isLoading}}async disconnectedCallback(){this.dispose(),crsbinding.utils.disposeProperties(this),crsbinding.observation.releaseBinding(this)}getProperty(e){return crsbinding.data.getProperty(this,e)}setProperty(e,t,n=!1){if(this.isReady!=!0&&n===!1&&this.__properties)return this.__properties.set(e,t);crsbinding.data.setProperty(this,e,t)}};var $=class extends HTMLElement{get hasOwnContext(){return!0}get ctx(){return this._dataId}set ctx(e){if(this._dataId=e,e!=null){let t=this.getAttribute("name");t!=null&&crsbinding.data.setName(this._dataId,t),this._loadView()}}get view(){return this._view}set view(e){this._view!=e&&(this._view=e,this._loadView())}constructor(){super();let e=this.getAttribute("ctx.one-way")||this.getAttribute("ctx.once");this.hasOwnContext==!0&&e==null&&(this._dataId=crsbinding.data.addObject(this.constructor.name),crsbinding.data.addContext(this._dataId,this)),crsbinding.dom.enableEvents(this)}dispose(){this._disposing=!0,crsbinding.utils.forceClean(this),crsbinding.dom.disableEvents(this),crsbinding.templates.unload(this.store)}async connectedCallback(){await this._initialize()}async _initialize(){this.__isLoading=!0,this.store=this.dataset.store||this.constructor.name,await crsbinding.templates.loadFromElement(this.store,this,this.html,async e=>{this.preLoad!=null&&await this.preLoad(),this.load!=null&&this.load(),this.__isLoading=!1,this.view=e.name})}async disconnectedCallback(){this.dispose(),crsbinding.utils.disposeProperties(this),crsbinding.observation.releaseBinding(this)}getProperty(e){return crsbinding.data.getProperty(this,e)}setProperty(e,t,n=!1){if(this.isReady!=!0&&n===!1&&this.__properties)return this.__properties.set(e,t);crsbinding.data.setProperty(this,e,t)}async _loadView(){if(this.__isLoading==!0||this._view==null||this._dataId==null)return;crsbinding.observation.releaseChildBinding(this),this.innerHTML="";let e=await crsbinding.templates.getById(this.store,this._view);this.appendChild(e),await crsbinding.parsers.parseElements(this.children,this._dataId,{folder:this.dataset.folder}),requestAnimationFrame(()=>{this.dataset.view=this._view,this.dispatchEvent(new CustomEvent("view-loaded"))})}};customElements.define("perspective-element",$);var te=class{get title(){return this.getProperty("title")}set title(e){this.setProperty("title",e)}get element(){return this._element}set element(e){this._element=e}constructor(e){this._dataId=crsbinding.data.addObject(this.constructor.name),crsbinding.data.addContext(this._dataId,this),this.element=e}async connectedCallback(){if(this.preLoad!=null){let t=(n,s)=>{crsbinding.data.setProperty(this._dataId,n,s)};await this.preLoad(t)}let e=crsbinding.utils.getPathOfFile(this.html);await crsbinding.parsers.parseElement(this.element,this._dataId,e?{folder:e}:null),this.load()}async disconnectedCallback(){crsbinding.utils.forceClean(this._dataId),crsbinding.observation.releaseBinding(this.element),crsbinding.utils.disposeProperties(this),this.element=null}getProperty(e,t=!0){return crsbinding.data.getProperty(this,e,t)}setProperty(e,t,n=!0){crsbinding.data.setProperty(this,e,t,n)}load(){this._element.style.visibility="",this._loaded=!0}};var A=class extends HTMLElement{disconnectedCallback(){this._clearElements(),delete this._dataId}async onMessage(e){this._clearElements();let t=e.context;if(t&&typeof t=="object"&&(t=t.__uid||t._dataId),this._dataId=t,this.innerHTML=e.html,this._dataId!=null){let n=crsbinding.data._context[this._dataId];await crsbinding.parsers.parseElements(this.children,this._dataId,{folder:n.html})}}_clearElements(){for(let e of this.children)crsbinding.observation.releaseBinding(e)}};customElements.define("crs-widget",A);var ne=class{constructor(){this._items=new Map}dispose(){this._items.clear(),this._items=null}register(e,t,n=!1){let s=crsbinding.utils.cloneTemplate(t),r={elements:[s],template:t};n===!0&&crsbinding.utils.measureElement(s).then(a=>r.size=a),this._items.set(e,r)}getItemElement(e){return e.elements.pop()||crsbinding.utils.cloneTemplate(e.template)}getElement(e){let t=this._items.get(e);return this.getItemElement(t)}getElements(e,t){let n=this._items.get(e),s=document.createDocumentFragment();for(;s.children.length<t;)s.appendChild(this.getItemElement(n));return s}async getBoundElement(e,t){let n=this._items.get(e),s=this.getItemElement(n);return await crsbinding.parsers.parseElement(s,t),s}returnElements(e,t){let n=this._items.get(e);for(let s of t)n.elements.push(s)}unregister(e){let t=this._items.get(e);t!=null&&(this._items.delete(e),t.elements.length=0,t.template=null)}};var se=class{constructor(){this._converters=new Map}add(e,t){this._converters.set(e,t)}get(e){return this._converters.get(e)}remove(e){this._converters.delete(e)}convert(e,t,n,s){let r=this._converters.get(t);return r==null?null:r[n](e,s)}};function Qe(i){if(typeof i=="object"&&(i=i.__uid||i._dataId),i==null)return;let e=crsbinding.data.removeObject(i),t=new Set;for(let n of e){let s=Array.from(crsbinding.providerManager.items).filter(r=>r[1]._context===n);for(let r of s)t.add(r[1]._element)}for(let n of t)crsbinding.providerManager.releaseElement(n);t.length=0}function Xe(i,e,t=null,n=null){let s="render-collection";crsbinding.inflationManager.register(s,i);let r=crsbinding.inflationManager.get(s,e,t,0);r!=null&&n!=null&&n.appendChild(r),crsbinding.inflationManager.unregister(s)}var ie=class{constructor(){this._tagMap=new Map,this._queue=[],this._observed=new Map}dispose(){this._tagMap.clear(),this._tagMap=null}define(e,t){this._tagMap.has(e)==!1&&this._tagMap.set(e,t),this._processElements(e)}parse(e){let t=e.querySelectorAll("[is]");if(t.length!=0){this._observe(e);for(let n of t){let s=n.getAttribute("is");this._tagMap.has(s)==!1?this._queue.push({parent:e,cName:s,el:n}):this._createComponent({parent:e,cName:s,el:n})}}}removeComponent(e){let t=null,n=e,s=0;for(;t==null||s==100;){if(s++,n.nodeName.toLocaleString()=="svg"){t=n;break}n=n.parentElement}this._removeComponentFromSvg(t,e)}_removeComponentFromSvg(e,t){let n=this._observed.get(e);if(n==null)return;let s=n.children.get(t);s!=null&&(s.disconnectedCallback(),s.dispose(),n.children.delete(t),t.parentElement.removeChild(t),s=null,t=null)}release(e){if(this._observed.size==0)return;let t=e.querySelectorAll("[is]");for(let s of t)this._removeComponentFromSvg(e,s);let n=this._observed.get(e);n.children.clear(),n.children=null,this._observed.delete(e)}_observe(e){if(this._observed.has(e))return;let t={children:new Map};this._observed.set(e,t)}_createComponent(e){let t=this._tagMap.get(e.cName),n=this._observed.get(e.parent);if(n.children.has(e.el)==!1){let s=new t(e.el);n.children.set(e.el,s),s.connectedCallback()}delete e.parent,delete e.cName,delete e.el}_processElements(e){let t=this._queue.filter(n=>n.cName==e);for(let n of t)this._createComponent(n),this._queue.splice(this._queue.indexOf(n),1)}};var re=class{constructor(e){this.element=e}dispose(){this.element=null}async connectedCallback(){}async suspend(){}async restore(){}};function Ze(i,e){crsbinding.templates.data[i]=e}function et(i){let e=Array.isArray(i)==!0?i:[i];for(let t of e)crsbinding.templates.data[t]?.count!=null?(crsbinding.templates.data[t].count-=1,crsbinding.templates.data[t].count==0&&(delete crsbinding.templates.data[t].templates,delete crsbinding.templates.data[t].style,delete crsbinding.templates.data[t])):delete crsbinding.templates.data[t]}function tt(){let i=Object.keys(crsbinding.templates.data);for(let e of i)delete crsbinding.templates.data[e]}async function nt(i,e){let t=crsbinding.templates.data[i];return t==null&&(t=await me(i,e)),t.cloneNode(!0).innerHTML}async function me(i,e){let t=crsbinding.templates.data[i];return t!=null||(t=document.createElement("template"),t.innerHTML=await fetch(e).then(n=>n.text()),crsbinding.templates.data[i]=t),t}async function st(i,e,t,n){if(crsbinding.templates.data[i]!=null){crsbinding.templates.data[i].count+=1,crsbinding.templates.data[i].callbacks.push(n);return}let s={count:1,templates:{},callbacks:[n]};crsbinding.templates.data[i]=s;let r,a;if(t!=null){let o=document.createElement("template");o.innerHTML=await fetch(t).then(c=>c.text()),r=o.content.querySelectorAll("template"),a=o.content.querySelector("style")}else r=e.querySelectorAll("template"),a=e.querySelector("style");s.style=a;let l;for(let o of r)s.templates[o.dataset.id]=o,o.parentElement?.removeChild(o),o.dataset.default=="true"&&(l=o);for(let o of s.callbacks){let c=Bt(l);a!=null&&c.insertBefore(a,c.firstChild),o(c)}s.callbacks.length=0,delete s.callbacks}function Bt(i){let e=i.content.cloneNode(!0);return e.name=i.dataset.id,e}async function it(i,e){let t=crsbinding.templates.data[i],s=t.templates[e].content.cloneNode(!0);return t.style!=null&&s.insertBefore(t.style,s.firstChild),s}var ae=class{constructor(){this.dictionary={}}dispose(){this.dictionary=null}async add(e,t){P(t||"",e,this.dictionary)}async delete(e){let t=`${e}.`,n=Object.keys(this.dictionary).filter(s=>s.indexOf(t)===0);for(let s of n)delete this.dictionary[s]}async parseElement(e){e.children.length==0&&e.textContent.indexOf("&{")!=-1&&(e.textContent=await this.get_with_markup(e.textContent.trim()));for(let t of e.attributes)await this.parseAttribute(t);for(let t of e.children)await this.parseElement(t)}async parseAttribute(e){e.nodeValue.indexOf("&{")!==-1&&(e.nodeValue=await this.get_with_markup(e.nodeValue))}async get(e){let t=this.dictionary[e];return t!=null||(t=this.fetch==null?null:await this.fetch(e),t!=null&&(this.dictionary[e]=t)),t}async get_with_markup(e){return e=e.split("&{").join("").split("}").join(""),await this.get(e)}};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};function Dt(i){let e=i.split("-");for(let n=1;n<e.length;n++)e[n]=e[n].capitalize();let t=e.join("");return t==="innerHtml"&&(t="innerHTML"),t}var v={_expFn:new Map,data:new X,idleTaskManager:new G,providerManager:new J,inflationManager:new Q,elementStoreManager:new ne,svgCustomElements:new ie,valueConvertersManager:new se,translations:new ae,expression:{sanitize:Ce,compile:ge,release:xe},observation:{releaseBinding:pe,releaseChildBinding:Ve},parsers:{parseElement:ze,parseElements:U},classes:{BindableElement:ee,PerspectiveElement:$,ViewBase:te,RepeatBaseProvider:g,Widget:A,SvgElement:re},events:{listenOnPath:Be,removeOnPath:De,emitter:new Z},dom:{enableEvents:Ue,disableEvents:Ke},utils:{capitalizePropertyPath:Dt,clone:We,disposeProperties:ce,fragmentToText:Te,cloneTemplate:Ie,measureElement:Se,forceClean:Qe,renderCollection:Xe,relativePathFrom:ke,getPathOfFile:he,getValueOnPath:_,flattenPropertyPath:P,getConverterParts:m},templates:{data:{},load:me,add:Ze,get:nt,unload:et,unloadAll:tt,loadFromElement:st,getById:it}};globalThis.crsbinding=v;v.$globals=v.data.addObject("globals");v.data.globals=v.data.getValue(v.$globals);globalThis.crsb=v;
